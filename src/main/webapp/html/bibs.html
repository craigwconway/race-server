<!DOCTYPE html>
<html>
  <head>
    <title>Bibs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link href="../styles/bootstrap.min.css" rel="stylesheet">

    </head>
  <body>
    
<div style="margin:12px;">

    <ul class="nav nav-tabs">
	  <li><a href="reader.html">Race day</a></li>
	  <li><a href="runners.html">Runners</a></li>
	  <li><a href="awards.html">Awards</a></li>
	  <li class="active"><a href="#">Admin</a></li>
	</ul>

	<div class="row" style="margin-top:15px;">
		<button type="button" class="btn btn-success" 
			style="margin:2px;" id="program-start"
			onclick="startReader();">Program</button>
		<button type="button" class="btn btn-danger" 
			style="margin:2px;display:none;" id="program-stop"
			onclick="stopReader();">Stop</button>
		<div id="status-bar" 
			class="progress progress-striped active status-warning"
			style="width: 100px;display:none;">
		</div>
	</div>
	
	<div id="results" class="row" 
		style="margin:30px;display:none;"> 
		<table id="raceresults" class="table"></table>
	</div>

</div>

<script src="../scripts/jquery-1.10.2.min.js"></script>
<script src="../scripts/bootstrap.min.js"></script>
    
<script>

var readerOn=false;

function startReader(){
	readerOn=true;
	$('#program-start').hide();
	$('#program-stop').show();
	$('#status-bar').show();
	var readerStart = $.ajax({
		url: "/bibs-server/events/start",
		type: "GET",
		data: { id : "start" },
		dataType: "html"
		});
	readerStart.done(function( msg ) {
		readerQuery();
		});
	readerStart.fail(function( jqXHR, textStatus ) {
		alert( "Error: " + textStatus );
		});
	
	// start polling
	setInterval(function(){
		if(!readerOn) return true;
		readerQuery();
		},3000);
	
}

function readerQuery(){
	var request = $.ajax({
		url: "/bibs-server/events/results",
		type: "GET",
		dataType: "json"
		});
	request.done(function( data ) {
		var results = "";
		for(var i in data){
			results += "<tr>";
			results += "<td>"+data[i].bib+"</td>";
			results += "<td>"+data[i].firstname+" "+data[i].lastname+"</td>";
			results += "<td>"+data[i].city+", "+data[i].state+"</td>";
			results += "<td>"+data[i].age+"</td>";
			results += "<td>"+data[i].gender+"</td>";
			results += "</tr>";
		}
		$('#raceresults').html(results);
		$('#results').show(500);
		});
	request.fail(function( jqXHR, textStatus ) {
		alert( "Error: " + textStatus );
		});
	$('#progress-bar').show();
	$('#program-start').hide();
	$('#program-stop').show();
}

function stopReader(){
	readerOn=false;
	var request = $.ajax({
		url: "/bibs-server/events/stop",
		type: "GET",
		dataType: "html"
		});
	request.done(function( msg ) {
		// ?
		});
	request.fail(function( jqXHR, textStatus ) {
		alert( "Error: " + textStatus );
		});
	$('#status-bar').hide();
	$('#program-start').show();
	$('#program-stop').hide();
}

</script>

  </body>
</html>
