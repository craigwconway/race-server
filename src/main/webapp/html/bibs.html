<!DOCTYPE html>
<html>
  <head>
    <title>Bibs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link href="../styles/bootstrap.min.css" rel="stylesheet">

    </head>
  <body>
    
<div style="margin:12px;">

    <ul class="nav nav-tabs">
	  <li><a href="reader.html">Race day</a></li>
	  <li><a href="runners.html">Runners</a></li>
	  <li><a href="awards.html">Awards</a></li>
	  <li class="active"><a href="#">Admin</a></li>
	</ul>

	<div style="margin:12px;">
		<input type="text" class="form-control" id="bib-input0" 
			style="display:inline;width:100px;" placeholder="First Bib">
		<input type="text" class="form-control" id="bib-input1" 
			style="display:inline;width:100px;" placeholder="Last Bib">
		<button type="button" class="btn btn-success" 
			style="margin-right:2px;" id="program-start"
			onclick="startReader();">Start Writing</button>
		<button type="button" class="btn btn-danger" 
			style="margin:2px;display:none;" id="program-stop"
			onclick="stopReader();">Stop Writing</button>
		<button type="button" class="btn" 
			style="margin:2px;display:none;" id="status">
				Writing Bibs...</button>
	</div>
	
	<div style="margin:12px;">
	<div class="container"><h4>OR</h4></div>
	</div>
	
	<div style="margin:12px;">
			    <input type="text" class="form-control" id="bib-input" 
			    	style="width:110px;display:inline;" placeholder="Bib Number">
			  <button type="button" class="btn btn-default" 
			  onclick="writeBib1()">
			  Write</button>
	</div>
	
	<div id="results" class="row" style="margin:12px;"> 
		<table id="raceresults" class="table"></table>
	</div>

</div>

<script src="../scripts/jquery-1.10.2.min.js"></script>
<script src="../scripts/bootstrap.min.js"></script>
    
<script>

var readerOn=false;

var currentBib = 0;
function startReader(){
	if(!validateMulti()) return;
	readerOn=true;
	$('#program-stop').show();
	$('#program-start').hide();
	$('#status').show(500);
	
	// set current bib
	if(currentBib==0) currentBib = $("#bib-input0").val();
	while(currentBib <= $("#bib-input1").val()){
		// write bib
		writeBib(currentBib);
		// pause for next bib
		if(!confirm(currentBib+" done. Next bib...")){
			stopReader();
			return;
		}
		// increment bib
		currentBib++;
	}
	alert("Done!");
	stopReader();
}

function stopReader(){
	readerOn=false;
	$('#status').hide(500);
	$('#program-start').show();
	$('#program-stop').hide();
}

function writeBib1(){
	var bib = $("#bib-input").val();
	$('#status-bar').html("Writing...");
	$('#status-bar').show(500);
	var request = $.ajax({
		url: "/bibs-server/events/write",
		type: "GET",
		data: {bib:$("#bib-input").val()},
		dataType: "html"
		});
	request.done(function( data ) {
		if(data != "true"){
			alert("Error writing bib.");
		}else{
			alert($("#bib-input").val()+" Written");
			$('#status-bar').html("Wrote "+bib);
		}
		});
	request.fail(function( jqXHR, textStatus ) {
		alert( "Error: " + textStatus );
		});
}
function writeBib(bib){
	$('#status-bar').html("Writing...");
	$('#status-bar').show(500);
	var request = $.ajax({
		url: "/bibs-server/events/write",
		type: "GET",
		data: {bib:bib},
		dataType: "html"
		});
	request.done(function( data ) {
		if(data != "true"){
			alert("Error writing bib.");
		}else{
			$('#status-bar').html(bib+" Written");
		}
		});
	request.fail(function( jqXHR, textStatus ) {
		alert( "Error: " + textStatus );
		stopReader();
		$("#bib-input0").val(currentBib);
		});
}

function validateMulti(){
	if($("#bib-input0").val() == ""){
		alert("First Bib required.")
		$("#bib-input0").focus();
		return false;
	}
	if($("#bib-input1").val() == ""){
		alert("Last Bib required.")
		$("#bib-input1").focus();
		return false;
	}
	return true;
}

</script>

  </body>
</html>
