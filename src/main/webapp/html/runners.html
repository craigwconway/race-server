<!DOCTYPE html>
<html>
  <head>
    <title>Bibs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link href="../styles/bootstrap.min.css" rel="stylesheet">

    </head>
<body>

<div style="margin:12px;">
      
    <ul class="nav nav-tabs">
	  <li><a href="reader.html">Race day</a></li>
	  <li class="active"><a href="/bibs-server/resources/html/runners.html">Runners</a></li>
	  <li><a href="awards.html">Awards</a></li>
	  <li><a href="bibs.html">Admin</a></li>
	</ul>

	<div class="row" style="margin-top:12px;">
	  	<div class="col-md-4">
			<button type="button" class="btn btn-default" 
				style="margin:2px;" onclick="addRunner()">Add</button>
			<button type="button" class="btn btn-default" 
				style="margin:2px;" onclick="importRunners()">Import</button>
			<button type="button" class="btn btn-default" 
				style="margin:2px;" onclick="exportRunners()">Export</button>
			<button type="button" class="btn btn-default" 
				style="margin:2px;" onclick="purge()">Purge</button>
		</div>
	  	<div class="col-md-4">
			    <input type="text" class="form-control" id="queryName" 
			    	style="width:200px;display:inline;"
			    	placeholder="Type a Runner's Name">
			  <button onclick="searchName()" class="btn btn-default">Search</button>
		</div>
	  	<div class="col-md-4">
			    <input type="text" class="form-control" id="query" 
			    	style="width:100px;display:inline;"
			    	placeholder="Type a Bib">
			  <button onclick="searchBib()" class="btn btn-default">Search</button>
		</div>
	</div>
		
	<div id="results"
		style="margin:30px;display:none;"> 
		<table id="raceresults" class="table table-striped">
		</table>
	</div>

</div>

<script src="../scripts/jquery-1.10.2.min.js"></script>
<script src="../scripts/bootstrap.min.js"></script>
    
<script>

$(document).ready(getRunners);

function addRunner(){
	window.open("/bibs-server/raceresults?form","app");
}

function editRunner(id){
	window.open("/bibs-server/raceresults/"+id+"?form","app");
}

function importRunners(){
	window.open("/bibs-server/resultsfiles?form","app");
}

function exportRunners(){
	return confirm("Export All Runners?");
}

function getRunners(){
	readerOn=false;
	var request = $.ajax({
		url: "/bibs-server/raceresults/byevent/ice?page=1&size=50",
		type: "GET",
		dataType: "json"
		});
	request.done(function( data ) {
			var results = "<tbody>" + makeTable(data) + "</tbody>";
			$('#raceresults').html(results);
			$('#results').show(500);
		});
	request.fail(function( jqXHR, textStatus ) {
		alert( "Error: " + textStatus );
		});
}

function searchBib(){
	var request = $.ajax({
		url: "/bibs-server/raceresults/bybib/ice/"+$("#query").val(),
		type: "GET",
		dataType: "json"
		});
	request.done(function( data1 ) {
			var data = [data1];
			var results = "<tbody>" + makeTable(data);
			results += "<tr><td colspan=\"99\"><a href=\"runners.html\">Show All Runners</a</td></tr>";
			results += "</tbody>";
			$('#raceresults').hide();
			$('#raceresults').empty();
			$('#raceresults').html(results);
			$('#raceresults').show(500);
		});
	request.fail(function( jqXHR, textStatus ) {
			alert("Bib Not Found");
			$("#query").focus();
		});
}

function searchName(){
	var fname = "ANY";
	var lname = "ANY";
	var query = $("#queryName").val();
	var parts = query.split(" ");
	if(parts.length == 1){
		lname = query;
	}else{
		fname = parts[0];
		lname = parts[parts.length-1];
	}
	var request = $.ajax({
		url: "/bibs-server/raceresults/byname/ice/"+fname+"/"+lname,
		type: "GET",
		dataType: "json"
		});
	request.done(function( data ) {
			var results = "<tbody>" + makeTable(data);
			results += "<tr><td colspan=\"99\"><a href=\"runners.html\">Show All Runners</a</td></tr>";
			results += "</tbody>";
			$('#raceresults').hide();
			$('#raceresults').empty();
			$('#raceresults').html(results);
			$('#raceresults').show(500);
		});
	request.fail(function( jqXHR, textStatus ) {
			alert("Runner Not Found");
			$("#queryName").focus();
		});
}

function purge(){
	if(!confirm("Delete ALL Runners?")) return;
	$("#raceresults").hide(500);
	var request = $.ajax({
		url: "/bibs-server/events/purge?event=19",
		type: "GET",
		dataType: "html"
		});
	request.done(function( data ) {
		$("#raceresults").empty();
		});
	request.fail(function( jqXHR, textStatus ) {
		alert( "Error: " + textStatus );
		});
}

function makeTable(data){
	var results = "";
	for(var i in data){
		results += "<tr onclick=\"editRunner("+data[i].id+")\">";
		results += "<td>"+data[i].bib+"</td>";
		results += "<td>"+data[i].timeoverall+"</td>";
		results += "<td>"+data[i].firstname+" "+data[i].lastname+"</td>";
		results += "<td>"+data[i].city+", "+data[i].state+"</td>";
		results += "<td>"+data[i].gender+"</td>";
		results += "<td>"+data[i].age+"</td>";
		results += "</tr>";
	}
	return results;
}
</script>

  </body>
</html>
